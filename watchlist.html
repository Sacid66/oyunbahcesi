<!DOCTYPE html>
<html lang="tr">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>İstek Listesi - Oyun Bahçesi</title>
   
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
   
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       body {
           font-family: "Inter Tight", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
           background-color: #f7f7f7;
           font-weight: 600;
           letter-spacing: -0.025em;
       }

       .header-top {
           background-color: #f7f7f7;
           padding: 8px 0;
           font-size: 13px;
           border-bottom: 1px solid #e5e5e5;
           font-weight: 400;
       }

       .header-top-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

       .header-left a {
           color: #0654ba;
           text-decoration: none;
           margin-right: 15px;
           font-weight: 700;
           letter-spacing: -0.01em;
           opacity: 0.9;
       }

       .header-right a {
           color: #333;
           text-decoration: none;
           margin-left: 15px;
           font-weight: 600;
           letter-spacing: -0.01em;
       }

.cart-icon {
    position: relative;
    display: inline-block;
    width: 20px;
    height: 20px;
    color: #333;
    opacity: 1 !important;
}

.cart-icon::before {
    content: "";
    position: absolute;
    width: 20px;
    height: 20px;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23333" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 22c.6 0 1-.4 1-1s-.4-1-1-1-1 .4-1 1 .4 1 1 1z"/><path d="M20 22c.6 0 1-.4 1-1s-.4-1-1-1-1 .4-1 1 .4 1 1 1z"/><path d="M1 1h4l2.7 13.4c.2 1 1.1 1.6 2.1 1.6h9.7c1 0 1.9-.8 2.1-1.6L23 6H6"/></svg>') no-repeat center;
    background-size: contain;
}

.cart-icon:hover {
    opacity: 0.7;
    transform: scale(1.1);
    transition: all 0.2s ease;
}

.cart-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #ff4444;
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    font-family: "Inter Tight", sans-serif;
    min-width: 18px;
    padding: 0 2px;
    box-sizing: border-box;
}

.cart-badge.hidden {
    display: none;
}

.notification-icon {
    position: relative;
    display: inline-block;
    width: 20px;
    height: 20px;
    color: #333;
    opacity: 1 !important;
    margin-right: 15px;
}

.notification-icon::before {
    content: "";
    position: absolute;
    width: 20px;
    height: 20px;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23333" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>') no-repeat center;
    background-size: contain;
}

.notification-icon:hover {
    opacity: 0.7;
    transform: scale(1.1);
    transition: all 0.2s ease;
}

.watchlist-link {
    color: #333;
    text-decoration: none;
    font-size: 13px;
    font-weight: 900;
    font-family: "Inter Tight", sans-serif;
    letter-spacing: -0.01em;
    margin-right: 15px;
    opacity: 1 !important;
    transition: all 0.2s ease;
    position: relative;
    top: -5px;
}

.watchlist-link:hover {
    color: #0654ba;
    transform: translateY(-1px);
}

       .main-header {
           background-color: white;
           padding: 15px 0;
           box-shadow: 0 1px 3px rgba(0,0,0,0.1);
           position: relative;
           overflow: visible;
       }

       .main-header-content {
           max-width: 1400px;
           margin: 0 auto;
           display: grid;
           grid-template-columns: auto auto 1fr auto;
           align-items: center;
           padding: 0 20px;
           gap: 20px;
           min-height: 80px;
       }

       .logo-container {
           width: 400px;
           height: 120px;
           display: flex;
           align-items: center;
           justify-content: flex-start;
           flex-shrink: 0;
           overflow: hidden;
           margin-left: -150px;
       }

       .logo {
           display: flex;
           align-items: center;
           text-decoration: none;
           max-width: 100%;
           max-height: 100%;
       }

       .logo img {
           height: 760px;
           width: auto;
           max-width: none;
           object-fit: contain;
           object-position: left center;
           margin-left: -400px;
       }

       .category-container {
           width: auto;
           flex-shrink: 0;
       }

       .category-dropdown {
           position: relative;
           width: 100%;
       }

       .category-btn {
           background: transparent;
           border: none;
           padding: 0;
           cursor: pointer;
           font-size: 14px;
           color: #333;
           display: flex;
           flex-direction: column;
           align-items: flex-start;
           justify-content: center;
           gap: 2px;
           white-space: nowrap;
           width: auto;
           min-height: 44px;
           position: relative;
           padding-right: 15px;
           font-family: "Inter Tight", sans-serif;
           font-weight: 600;
           letter-spacing: -0.02em;
           opacity: 0.8;
       }

       .category-btn::after {
           content: "▼";
           position: absolute;
           right: 0;
           top: 50%;
           transform: translateY(-50%);
           font-size: 10px;
       }

       .category-btn:hover {
           background-color: #f5f5f5;
           border-radius: 8px;
       }

       .dropdown-content {
           display: none;
           position: absolute;
           top: calc(100% + 10px);
           left: -50px;
           background-color: white;
           min-width: 800px;
           box-shadow: 0 8px 16px rgba(0,0,0,0.1);
           z-index: 1000;
           border: 1px solid #ddd;
           border-radius: 20px;
           padding: 20px;
       }

       .dropdown-content.show {
           display: block;
       }

       .dropdown-grid {
           display: grid;
           grid-template-columns: repeat(3, 1fr);
           gap: 30px;
       }

       .dropdown-column h3 {
           font-size: 16px;
           color: #333;
           margin-bottom: 15px;
           font-weight: 700;
           font-family: "Inter Tight", sans-serif;
           letter-spacing: -0.03em;
       }

       .dropdown-column ul {
           list-style: none;
       }

       .dropdown-column li {
           margin-bottom: 8px;
       }

       .dropdown-column a {
           color: #666;
           text-decoration: none;
           font-size: 14px;
           font-weight: 600;
           letter-spacing: -0.01em;
           opacity: 0.85;
       }

       .dropdown-column a:hover {
           color: #0654ba;
           font-weight: 600;
       }

       .search-section {
           display: flex;
           align-items: center;
           gap: 15px;
           min-width: 0;
       }

       .search-container {
           display: flex;
           border: 2px solid #000000;
           border-radius: 50px;
           overflow: hidden;
           background: white;
           box-shadow: 0 2px 8px rgba(54, 101, 243, 0.15);
           min-width: 300px;
           flex: 1;
           max-width: 600px;
       }

       .search-input {
           flex: 1;
           padding: 12px 20px;
           border: none;
           font-size: 15px;
           outline: none;
           background: transparent;
           color: #333;
           min-width: 0;
           font-family: "Inter Tight", sans-serif;
           font-weight: 600;
           letter-spacing: -0.01em;
       }

       .search-input::placeholder {
           color: #999;
           font-weight: 500;
           opacity: 0.8;
       }

       .search-btn {
           padding: 12px 24px;
           background: #3665f3;
           color: white;
           border: none;
           cursor: pointer;
           font-size: 14px;
           font-weight: 700;
           transition: background-color 0.2s ease;
           flex-shrink: 0;
           white-space: nowrap;
           border-radius: 25px;
           font-family: "Inter Tight", sans-serif;
           letter-spacing: -0.01em;
           text-transform: uppercase;
       }

       .search-btn:hover {
           background: #2c54e8;
       }

       .search-btn:active {
           background: #1e3a8a;
           transform: translateY(1px);
       }

       .header-right-nav {
           width: 100px;
           display: flex;
           align-items: center;
           justify-content: flex-end;
           flex-shrink: 0;
       }

       .header-right-nav a {
           color: #333;
           text-decoration: none;
           font-size: 13px;
           font-weight: 600;
           letter-spacing: -0.01em;
       }

       .breadcrumb {
           background: white;
           padding: 15px 0;
           border-bottom: 1px solid #e5e5e5;
       }

       .breadcrumb-content {
           max-width: 1400px;
           margin: 0 auto;
           padding: 0 20px;
           display: flex;
           align-items: center;
           gap: 8px;
           font-size: 14px;
       }

       .breadcrumb a {
           color: #666;
           text-decoration: none;
           font-weight: 500;
       }

       .breadcrumb a:hover {
           color: #0654ba;
       }

       .breadcrumb-separator {
           color: #999;
       }

       .breadcrumb-current {
           color: #333;
           font-weight: 600;
       }

       .main-content {
           max-width: 1400px;
           margin: 0 auto;
           padding: 30px 20px;
           display: grid;
           grid-template-columns: 250px 1fr;
           gap: 30px;
       }

       .category-header {
           grid-column: 1 / -1;
           margin-bottom: 20px;
       }

       .category-title {
           font-size: 32px;
           font-weight: 700;
           color: #333;
           margin-bottom: 10px;
       }

       .category-description {
           font-size: 16px;
           color: #666;
           font-weight: 500;
           line-height: 1.5;
       }

       .categories-sidebar {
           background: white;
           border-radius: 8px;
           padding: 20px 15px;
           height: fit-content;
           position: sticky;
           top: 20px;
       }

       .sidebar-title {
           font-size: 16px;
           font-weight: 700;
           color: #333;
           margin-bottom: 15px;
           padding-bottom: 8px;
           border-bottom: 1px solid #eee;
       }

       .wishlist-info {
           color: #666;
           font-size: 14px;
           font-weight: 500;
           text-align: center;
           padding: 20px;
           background: #f8f9fa;
           border-radius: 8px;
       }

       .products-section {
           display: flex;
           flex-direction: column;
           gap: 20px;
       }

       .products-header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           background: white;
           padding: 20px 25px;
           border-radius: 12px;
           box-shadow: 0 2px 8px rgba(0,0,0,0.05);
       }

       .results-count {
           font-size: 16px;
           color: #333;
           font-weight: 600;
       }

       .sort-dropdown {
           display: flex;
           align-items: center;
           gap: 10px;
       }

       .sort-select {
           padding: 8px 15px;
           border: 1px solid #ddd;
           border-radius: 20px;
           font-size: 14px;
           background: white;
           cursor: pointer;
       }

       .products-grid {
           display: grid;
           grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
           gap: 25px;
       }

       .product-card {
           background: white;
           border-radius: 12px;
           overflow: hidden;
           box-shadow: 0 2px 12px rgba(0,0,0,0.08);
           transition: all 0.3s ease;
           cursor: pointer;
           position: relative;
       }

       .product-card:hover {
           transform: translateY(-5px);
           box-shadow: 0 8px 25px rgba(0,0,0,0.15);
       }

       .product-image {
           width: 100%;
           height: 220px;
           background: #f8f9fa;
           display: flex;
           align-items: center;
           justify-content: center;
           position: relative;
           overflow: hidden;
       }

       .product-image img {
           width: 100%;
           height: 100%;
           object-fit: cover;
       }

       .product-image::before {
           content: '';
           width: 120px;
           height: 120px;
           background: #ddd;
           border-radius: 8px;
       }

       .product-image.has-image::before {
           display: none;
       }

       .product-info {
           padding: 20px;
       }

       .product-title {
           font-size: 16px;
           font-weight: 600;
           color: #333;
           margin-bottom: 8px;
           line-height: 1.3;
       }

       .product-specs {
           font-size: 13px;
           color: #666;
           margin-bottom: 12px;
           font-weight: 500;
       }

       .product-price {
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 15px;
       }

       .current-price {
           font-size: 20px;
           font-weight: 700;
           color: #333;
       }

       .product-actions {
           display: flex;
           gap: 10px;
       }

       .add-to-cart-btn {
           flex: 1;
           background: #3665f3;
           color: white;
           border: none;
           padding: 10px 15px;
           border-radius: 20px;
           font-size: 14px;
           font-weight: 600;
           cursor: pointer;
       }

       .add-to-cart-btn:hover {
           background: #2c54e8;
       }

       .remove-btn {
           width: 40px;
           height: 40px;
           border: 1px solid #ff4444;
           background: white;
           border-radius: 50%;
           display: flex;
           align-items: center;
           justify-content: center;
           cursor: pointer;
           color: #ff4444;
           font-size: 16px;
       }

       .remove-btn:hover {
           background: #ff4444;
           color:
            white;
       }

       .wishlist-btn {
    width: 40px;
    height: 40px;
    border: 1px solid #ff4444;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #ff4444;
    font-size: 16px;
}

.wishlist-btn:hover {
    background: #ff4444;
    color: white;
}

       .empty-state {
           text-align: center;
           padding: 60px 20px;
           background: white;
           border-radius: 12px;
           grid-column: 1 / -1;
       }

       .empty-state h3 {
           font-size: 24px;
           color: #333;
           margin-bottom: 10px;
           font-weight: 700;
       }

       .empty-state p {
           font-size: 16px;
           color: #666;
           margin-bottom: 30px;
       }

       .empty-state button {
           background: #3665f3;
           color: white;
           border: none;
           padding: 12px 24px;
           border-radius: 25px;
           font-size: 14px;
           font-weight: 600;
           cursor: pointer;
       }

       .empty-state button:hover {
           background: #2c54e8;
       }

       /* Responsive Design */
       @media (max-width: 1200px) {
           .main-header-content {
               grid-template-columns: auto auto 1fr;
               gap: 15px;
           }
           
           .logo-container {
               width: 200px;
           }
           
           .logo img {
               max-width: 190px;
           }
           
           .category-container {
               width: 180px;
           }
           
           .header-right-nav {
               display: none;
           }
       }

       @media (max-width: 992px) {
           .main-header-content {
               grid-template-columns: auto 1fr;
               gap: 15px;
           }
           
           .category-container {
               grid-column: 1 / -1;
               width: 100%;
               margin-top: 10px;
           }
           
           .logo-container {
               width: 180px;
               height: 60px;
           }
           
           .logo img {
               height: 540px;
               max-width: 170px;
           }
           
           .search-container {
               min-width: 250px;
           }
       }

       @media (max-width: 768px) {
           .main-header-content {
               grid-template-columns: 1fr;
               text-align: center;
               gap: 15px;
           }
           
           .logo-container {
               width: 100%;
               justify-content: center;
               height: 50px;
           }
           
           .logo img {
               height: 400px;
               max-width: 150px;
           }
           
           .search-section {
               width: 100%;
           }
           
           .search-container {
               min-width: auto;
               width: 100%;
           }
           
           .category-container {
               width: 100%;
               margin-top: 15px;
           }
       }

       @media (max-width: 480px) {
           .logo img {
               height: 300px;
               max-width: 120px;
           }
       }
   </style>
</head>
<body>
   <!-- Header Top -->
   <div class="header-top">
       <div class="header-top-content">
           <div class="header-left" id="headerLeft">
               <a href="login.html">Hi! Giriş Yap</a> veya 
               <a href="register.html">kayıt ol</a>
           </div>
           <div class="header-right">
               <a href="watchlist.html" class="watchlist-link">Watchlist</a>
               <a href="#" class="notification-icon"></a>
               <a href="basket.html" class="cart-icon">
    <span class="cart-badge hidden" id="cartBadge">0</span>
</a>
           </div>
       </div>
   </div>

   <!-- Main Header -->
   <div class="main-header">
       <div class="main-header-content">
           <div class="logo-container">
               <a href="index.html" class="logo">
                   <img src="images/logo.png" alt="Oyun Bahçesi Logo">
               </a>
           </div>
           
           <div class="category-container">
               <div class="category-dropdown">
                   <button class="category-btn" onclick="toggleDropdown()">
                       <span>Kategoriye</span>
                       <span>Göre</span>
                   </button>
                   <div class="dropdown-content" id="categoryDropdown">
                       <div class="dropdown-grid">
                           <div class="dropdown-column">
                               <h3>Kent Mobilyası</h3>
                               <ul>
                                   <li><a href="category.html?category=Kamelyalar">Kamelyalar</a></li>
                                   <li><a href="category.html?category=Pergole">Pergole</a></li>
                                   <li><a href="category.html?category=Köprüler">Köprüler</a></li>
                                   <li><a href="category.html?category=Bekçi%20Kulübesi">Bekçi Kulübesi</a></li>
                                   <li><a href="category.html?category=Çitler">Çitler</a></li>
                                   <li><a href="category.html?category=Banklar">Banklar</a></li>
                                   <li><a href="category.html?category=Saksılar">Saksılar</a></li>
                                   <li><a href="category.html?category=Kulübeler">Kulübeler</a></li>
                                   <li><a href="category.html?category=Yer%20ve%20Duvar%20Döşeme">Yer ve Duvar Döşeme</a></li>
                               </ul>
                           </div>
                           <div class="dropdown-column">
                               <h3>Oyun Grupları ve Parklar</h3>
                               <ul>
                                   <li><a href="category.html?category=Parklar">Parklar</a></li>
                                   <li><a href="category.html?category=Salıncaklar">Salıncaklar</a></li>
                                   <li><a href="category.html?category=Tırmanmalar">Tırmanmalar</a></li>
                                   <li><a href="category.html?category=Ahşap%20Oyun%20Evleri">Ahşap Oyun Evleri</a></li>
                                   <li><a href="category.html?category=Tahtarevalli%20ve%20Zıp%20Zıp">Tahtarevalli ve Zıp Zıp</a></li>
                                   <li><a href="category.html?category=Kauçuklar">Kauçuklar</a></li>
                                   <li><a href="category.html?category=Kum%20Havuzu">Kum Havuzu</a></li>
                               </ul>
                           </div>
                           <div class="dropdown-column">
    <h3>Ormanın Kalbi</h3>
    <ul>
        <li><a href="category.html?category=Orman%20Evleri">Orman Evleri</a></li>
    </ul>
</div>
                       </div>
                   </div>
               </div>
           </div>

           <div class="search-section">
               <div class="search-container">
                   <input type="text" class="search-input" placeholder="İstek listemde ara...">
               </div>
               <button class="search-btn">Ara</button>
           </div>


       </div>
   </div>

   <div class="breadcrumb">
       <div class="breadcrumb-content">
           <a href="index.html">Ana Sayfa</a>
           <span class="breadcrumb-separator">›</span>
           <span class="breadcrumb-current">İstek Listesi</span>
       </div>
   </div>

   <div class="main-content">
       <div class="category-header">
           <h1 class="category-title">İstek Listesi</h1>
           <p class="category-description" id="category-description">Beğendiğiniz ürünleri buradan takip edebilirsiniz.</p>
       </div>

       <div class="categories-sidebar">
           <h3 class="sidebar-title">İstek Listesi <span id="wishlist-count">(0)</span></h3>
           <div class="wishlist-info">
               Kalp ikonuna tıklayarak ürünleri istek listenize ekleyebilirsiniz.
           </div>
       </div>

       <div class="products-section">
           <div class="products-header">
               <div class="results-count" id="results-count">0 ürün</div>
               <div class="sort-dropdown">
                   <label for="sort">Sırala:</label>
                   <select class="sort-select" id="sort">
                       <option value="newest">En Yeni Eklenenler</option>
                       <option value="oldest">En Eski Eklenenler</option>
                       <option value="price-low">Fiyat: Düşükten Yükseğe</option>
                       <option value="price-high">Fiyat: Yüksekten Düşüğe</option>
                   </select>
               </div>
           </div>

           <div class="products-grid" id="products-grid">
               <!-- Ürünler burada gösterilecek -->
           </div>
       </div>
   </div>

   <script>
       // Kullanıcı durumunu kontrol et
       function checkUserStatus() {
           const currentUser = localStorage.getItem('currentUser');
           const headerLeft = document.getElementById('headerLeft');
           
           if (currentUser) {
               const user = JSON.parse(currentUser);
               if (user.loggedIn) {
                   headerLeft.innerHTML = `
                       <div style="display: flex; align-items: center; gap: 10px;">
                           <span style="color: #333; font-weight: 600;">Hi ${user.firstName}! ▼</span>
                           <a href="#" onclick="logout()" style="color: #0654ba; text-decoration: none; font-size: 12px; opacity: 0.8;">Çıkış</a>
                       </div>
                   `;
               }
           }
       }

       // Çıkış fonksiyonu
       function logout() {
           localStorage.removeItem('currentUser');
           location.reload();
       }

       // Watchlist'i yükle
// Ürünleri JSON'dan yükle
async function loadAllProductsFromJson() {
    try {
        const response = await fetch('https://raw.githubusercontent.com/KULLANICI_ADI/REPO_ADI/main/build/products.json');
        const data = await response.json();
        
        const allProducts = [];
        Object.values(data).forEach(categoryProducts => {
            allProducts.push(...categoryProducts);
        });
        
        return allProducts;
    } catch (error) {
        console.error('Ürünler yüklenirken hata:', error);
        return [];
    }
}

// Watchlist'i yükle
async function loadWatchlist() {
    const currentUser = localStorage.getItem('currentUser');
    
    if (!currentUser) {
        showLoginRequired();
        return;
    }

    const user = JSON.parse(currentUser);
    const watchlistKey = `watchlist_${user.email}`;
    const watchlist = JSON.parse(localStorage.getItem(watchlistKey) || '[]');
    
    // JSON'dan tüm mevcut ürünleri yükle
    const allProducts = await loadAllProductsFromJson();
    
    // Watchlist'teki ürünlerin hala JSON'da olup olmadığını kontrol et
    const validWatchlist = watchlist.filter(watchlistItem => {
        return allProducts.some(product => product.id == watchlistItem.id);
    });
    
    // Eğer silinen ürünler varsa watchlist'i güncelle
    if (validWatchlist.length !== watchlist.length) {
        localStorage.setItem(watchlistKey, JSON.stringify(validWatchlist));
        console.log(`${watchlist.length - validWatchlist.length} silinen ürün watchlist'ten temizlendi`);
    }
    
    // Sayıları güncelle
    document.getElementById('wishlist-count').textContent = `(${validWatchlist.length})`;
    document.getElementById('results-count').textContent = `${validWatchlist.length} ürün`;
    document.getElementById('category-description').textContent = 
        validWatchlist.length > 0 ? 
        `${validWatchlist.length} ürününüz istek listenizde bulunuyor.` : 
        'Henüz istek listenize ürün eklemediniz.';

    if (validWatchlist.length === 0) {
        showEmptyState();
        return;
    }

    // Ürünleri göster
    loadProducts(validWatchlist);
}

       function showLoginRequired() {
           const productsGrid = document.getElementById('products-grid');
           productsGrid.innerHTML = `
               <div class="empty-state">
                   <div style="font-size: 48px; margin-bottom: 20px;">🔒</div>
                   <h3>Giriş Yapmanız Gerekiyor</h3>
                   <p>İstek listenizi görmek için lütfen giriş yapın.</p>
                   <button onclick="window.location.href='login.html'">Giriş Yap</button>
               </div>
           `;
       }

       function showEmptyState() {
           const productsGrid = document.getElementById('products-grid');
           productsGrid.innerHTML = `
               <div class="empty-state">
                   <div style="font-size: 48px; margin-bottom: 20px;">💝</div>
                   <h3>İstek listeniz boş</h3>
                   <p>Beğendiğiniz ürünleri kalp simgesine tıklayarak buraya ekleyebilirsiniz.</p>
                   <button onclick="window.location.href='index.html'">Alışverişe Başla</button>
               </div>
           `;
       }

       function loadProducts(products) {
           const productsGrid = document.getElementById('products-grid');
           productsGrid.innerHTML = '';

           products.forEach(product => {
               const productCard = createProductCard(product);
               productsGrid.appendChild(productCard);
           });
       }

       function createProductCard(product) {
           const card = document.createElement('div');
           card.className = 'product-card';
           card.onclick = () => window.location.href = `details.html?id=${product.id}`;

           const hasImage = product.image ? 'has-image' : '';
           const imageContent = product.image ? `<img src="${product.image}" alt="${product.title}">` : '';

           card.innerHTML = `
<div class="product-image ${hasImage}">
    ${imageContent}
</div>
               <div class="product-info">
                   <h3 class="product-title">${product.title}</h3>
                   <p class="product-specs">${product.specs || ''}</p>
                   <div class="product-price">
                       <span class="current-price">${product.price}</span>
                   </div>
<div class="product-actions">
    <button class="add-to-cart-btn">Sepete Ekle</button>
    <button class="wishlist-btn" onclick="event.stopPropagation(); removeFromWatchlist('${product.id}')" style="color: #ff4444;">♥</button>
</div>
               </div>
           `;

           const addToCartBtn = card.querySelector('.add-to-cart-btn');
           
           addToCartBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    
    const currentUser = localStorage.getItem('currentUser');
    if (!currentUser) {
        alert('Sepete ürün eklemek için lütfen giriş yapın!');
        return;
    }
    
    this.textContent = 'Ekleniyor...';
    this.style.opacity = '0.7';
    
    // Sepete ekle
    const added = addToBasket(product.id, product.title, product.price, product.image || '', product.specs || '');
    
    setTimeout(() => {
        if (added) {
            this.textContent = 'Sepete Eklendi';
            this.style.background = '#00c853';
            updateCartBadge();
            
            setTimeout(() => {
                this.textContent = 'Sepete Ekle';
                this.style.background = '#3665f3';
                this.style.opacity = '1';
            }, 2000);
        }
    }, 1000);
});

           return card;
       }

       // Watchlist'den ürün çıkarma
       function removeFromWatchlist(productId) {
    const currentUser = localStorage.getItem('currentUser');
    if (!currentUser) return;
    
    const user = JSON.parse(currentUser);
    const watchlistKey = `watchlist_${user.email}`;
    const watchlist = JSON.parse(localStorage.getItem(watchlistKey) || '[]');
    const filtered = watchlist.filter(item => item.id !== productId);
    localStorage.setItem(watchlistKey, JSON.stringify(filtered));
           
           // Sayfayı yenile
           loadWatchlist();
       }

       // Sıralama
function sortProducts() {
    const sortValue = document.getElementById('sort').value;
    const currentUser = localStorage.getItem('currentUser');
    if (!currentUser) return;
    
    const user = JSON.parse(currentUser);
    const watchlistKey = `watchlist_${user.email}`;
    const watchlist = JSON.parse(localStorage.getItem(watchlistKey) || '[]');
    
    let sorted = [...watchlist];
    
    switch(sortValue) {
        case 'newest':
            sorted.sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt));
            break;
        case 'oldest':
            sorted.sort((a, b) => new Date(a.addedAt) - new Date(b.addedAt));
            break;
        case 'price-low':
            sorted.sort((a, b) => parseFloat(a.price.replace('₺', '').replace('.', '').replace(',', '.')) - parseFloat(b.price.replace('₺', '').replace('.', '').replace(',', '.')));
            break;
        case 'price-high':
            sorted.sort((a, b) => parseFloat(b.price.replace('₺', '').replace('.', '').replace(',', '.')) - parseFloat(a.price.replace('₺', '').replace('.', '').replace(',', '.')));
            break;
    }
    
    loadProducts(sorted);
}

       // Dropdown toggle
       function toggleDropdown() {
           const dropdown = document.getElementById('categoryDropdown');
           dropdown.classList.toggle('show');
       }

       // Close dropdown when clicking outside
       window.onclick = function(event) {
           if (!event.target.matches('.category-btn') && !event.target.matches('.category-btn span')) {
               const dropdown = document.getElementById('categoryDropdown');
               if (dropdown.classList.contains('show')) {
                   dropdown.classList.remove('show');
               }
           }
       }

       // Arama fonksiyonu
function searchWatchlist() {
    const searchTerm = document.querySelector('.search-input').value.toLowerCase().trim();
    const currentUser = localStorage.getItem('currentUser');
    if (!currentUser) return;
    
    const user = JSON.parse(currentUser);
    const watchlistKey = `watchlist_${user.email}`;
    const watchlist = JSON.parse(localStorage.getItem(watchlistKey) || '[]');
    
    if (!searchTerm) {
        loadProducts(watchlist);
        return;
    }
    
    const filtered = watchlist.filter(product => 
        product.title.toLowerCase().includes(searchTerm) ||
        (product.specs && product.specs.toLowerCase().includes(searchTerm))
    );
    
    document.getElementById('results-count').textContent = `${filtered.length} ürün`;
    loadProducts(filtered);
}

function updateCartBadge() {
    const currentUser = localStorage.getItem('currentUser');
    const cartBadge = document.getElementById('cartBadge');
    
    if (!currentUser || !cartBadge) {
        if (cartBadge) cartBadge.classList.add('hidden');
        return;
    }
    
    const user = JSON.parse(currentUser);
    const basketKey = `basket_${user.email}`;
    const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
    
    const totalItems = basket.reduce((sum, item) => sum + item.quantity, 0);
    
    if (totalItems > 0) {
        cartBadge.textContent = totalItems > 99 ? '99+' : totalItems.toString();
        cartBadge.classList.remove('hidden');
    } else {
        cartBadge.classList.add('hidden');
    }
}

// LocalStorage değişikliklerini dinle
function listenForCartChanges() {
    window.addEventListener('storage', function(e) {
        if (e.key && e.key.includes('basket_')) {
            updateCartBadge();
        }
    });
    
    // Aynı sekme içindeki değişiklikleri takip et
    const originalSetItem = localStorage.setItem;
    localStorage.setItem = function(key, value) {
        originalSetItem.apply(this, arguments);
        if (key.includes('basket_')) {
            updateCartBadge();
        }
    };
}

       // Event listeners
document.addEventListener('DOMContentLoaded', function() {
    checkUserStatus();
    updateCartBadge();
    listenForCartChanges(); // BUNU EKLE
    loadWatchlist();
    
    // Sıralama event listener
    document.getElementById('sort').addEventListener('change', sortProducts);
    
    // Arama event listeners
    document.querySelector('.search-btn').addEventListener('click', searchWatchlist);
    document.querySelector('.search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchWatchlist();
        }
    });
    
    // Gerçek zamanlı arama
    document.querySelector('.search-input').addEventListener('input', function() {
        setTimeout(searchWatchlist, 300);
    });
});

       // Sepet fonksiyonları
function addToBasket(productId, title, price, image, specs) {
    const currentUser = localStorage.getItem('currentUser');
    if (!currentUser) return false;
    
    const user = JSON.parse(currentUser);
    const basketKey = `basket_${user.email}`;
    const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
    
    const existingItem = basket.find(item => item.id === productId);
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        basket.push({
            id: productId,
            title: title,
            price: price,
            image: image,
            specs: specs,
            quantity: 1,
            addedAt: new Date().toISOString()
        });
    }
    
    localStorage.setItem(basketKey, JSON.stringify(basket));
    return true;
}
   </script>
</body>
</html>