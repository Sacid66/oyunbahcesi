<!DOCTYPE html>
<html lang="tr">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Sepet - Oyun Bahçesi</title>
   
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
   
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       body {
           font-family: "Inter Tight", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
           background-color: #f7f7f7;
           font-weight: 600;
           letter-spacing: -0.025em;
       }

       .header-top {
           background-color: #f7f7f7;
           padding: 8px 0;
           font-size: 13px;
           border-bottom: 1px solid #e5e5e5;
           font-weight: 400;
       }

       .header-top-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

       .header-left a {
           color: #0654ba;
           text-decoration: none;
           margin-right: 15px;
           font-weight: 700;
           letter-spacing: -0.01em;
           opacity: 0.9;
       }

       .header-right a {
           color: #333;
           text-decoration: none;
           margin-left: 15px;
           font-weight: 600;
           letter-spacing: -0.01em;
       }

.cart-icon {
    position: relative;
    display: inline-block;
    width: 20px;
    height: 20px;
    color: #333;
    opacity: 1 !important;
}

.cart-icon::before {
    content: "";
    position: absolute;
    width: 20px;
    height: 20px;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23333" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 22c.6 0 1-.4 1-1s-.4-1-1-1-1 .4-1 1 .4 1 1 1z"/><path d="M20 22c.6 0 1-.4 1-1s-.4-1-1-1-1 .4-1 1 .4 1 1 1z"/><path d="M1 1h4l2.7 13.4c.2 1 1.1 1.6 2.1 1.6h9.7c1 0 1.9-.8 2.1-1.6L23 6H6"/></svg>') no-repeat center;
    background-size: contain;
}

.cart-icon:hover {
    opacity: 0.7;
    transform: scale(1.1);
    transition: all 0.2s ease;
}

.notification-icon {
    position: relative;
    display: inline-block;
    width: 20px;
    height: 20px;
    color: #333;
    opacity: 1 !important;
    margin-right: 15px;
}

.notification-icon::before {
    content: "";
    position: absolute;
    width: 20px;
    height: 20px;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23333" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>') no-repeat center;
    background-size: contain;
}

.notification-icon:hover {
    opacity: 0.7;
    transform: scale(1.1);
    transition: all 0.2s ease;
}

.watchlist-link {
    color: #333;
    text-decoration: none;
    font-size: 13px;
    font-weight: 900;
    font-family: "Inter Tight", sans-serif;
    letter-spacing: -0.01em;
    margin-right: 15px;
    opacity: 1 !important;
    transition: all 0.2s ease;
    position: relative;
    top: -5px;
}

.watchlist-link:hover {
    color: #0654ba;
    transform: translateY(-1px);
}

       .main-header {
           background-color: white;
           padding: 15px 0;
           box-shadow: 0 1px 3px rgba(0,0,0,0.1);
           position: relative;
           overflow: visible;
       }

       .main-header-content {
           max-width: 1400px;
           margin: 0 auto;
           display: grid;
           grid-template-columns: auto auto 1fr auto;
           align-items: center;
           padding: 0 20px;
           gap: 20px;
           min-height: 80px;
       }

       .logo-container {
           width: 400px;
           height: 120px;
           display: flex;
           align-items: center;
           justify-content: flex-start;
           flex-shrink: 0;
           overflow: hidden;
           margin-left: -150px;
       }

       .logo {
           display: flex;
           align-items: center;
           text-decoration: none;
           max-width: 100%;
           max-height: 100%;
       }

       .logo img {
           height: 760px;
           width: auto;
           max-width: none;
           object-fit: contain;
           object-position: left center;
           margin-left: -400px;
       }

       .category-container {
           width: auto;
           flex-shrink: 0;
       }

       .category-dropdown {
           position: relative;
           width: 100%;
       }

       .category-btn {
           background: transparent;
           border: none;
           padding: 0;
           cursor: pointer;
           font-size: 14px;
           color: #333;
           display: flex;
           flex-direction: column;
           align-items: flex-start;
           justify-content: center;
           gap: 2px;
           white-space: nowrap;
           width: auto;
           min-height: 44px;
           position: relative;
           padding-right: 15px;
           font-family: "Inter Tight", sans-serif;
           font-weight: 600;
           letter-spacing: -0.02em;
           opacity: 0.8;
       }

       .category-btn::after {
           content: "▼";
           position: absolute;
           right: 0;
           top: 50%;
           transform: translateY(-50%);
           font-size: 10px;
       }

       .category-btn:hover {
           background-color: #f5f5f5;
           border-radius: 8px;
       }

       .dropdown-content {
           display: none;
           position: absolute;
           top: calc(100% + 10px);
           left: -50px;
           background-color: white;
           min-width: 800px;
           box-shadow: 0 8px 16px rgba(0,0,0,0.1);
           z-index: 1000;
           border: 1px solid #ddd;
           border-radius: 20px;
           padding: 20px;
       }

       .dropdown-content.show {
           display: block;
       }

       .dropdown-grid {
           display: grid;
           grid-template-columns: repeat(3, 1fr);
           gap: 30px;
       }

       .dropdown-column h3 {
           font-size: 16px;
           color: #333;
           margin-bottom: 15px;
           font-weight: 700;
           font-family: "Inter Tight", sans-serif;
           letter-spacing: -0.03em;
       }

       .dropdown-column ul {
           list-style: none;
       }

       .dropdown-column li {
           margin-bottom: 8px;
       }

       .dropdown-column a {
           color: #666;
           text-decoration: none;
           font-size: 14px;
           font-weight: 600;
           letter-spacing: -0.01em;
           opacity: 0.85;
       }

       .dropdown-column a:hover {
           color: #0654ba;
           font-weight: 600;
       }

       .search-section {
           display: flex;
           align-items: center;
           gap: 15px;
           min-width: 0;
       }

       .search-container {
           display: flex;
           border: 2px solid #000000;
           border-radius: 50px;
           overflow: hidden;
           background: white;
           box-shadow: 0 2px 8px rgba(54, 101, 243, 0.15);
           min-width: 300px;
           flex: 1;
           max-width: 600px;
       }

       .search-input {
           flex: 1;
           padding: 12px 20px;
           border: none;
           font-size: 15px;
           outline: none;
           background: transparent;
           color: #333;
           min-width: 0;
           font-family: "Inter Tight", sans-serif;
           font-weight: 600;
           letter-spacing: -0.01em;
       }

       .search-input::placeholder {
           color: #999;
           font-weight: 500;
           opacity: 0.8;
       }

       .search-btn {
           padding: 12px 24px;
           background: #3665f3;
           color: white;
           border: none;
           cursor: pointer;
           font-size: 14px;
           font-weight: 700;
           transition: background-color 0.2s ease;
           flex-shrink: 0;
           white-space: nowrap;
           border-radius: 25px;
           font-family: "Inter Tight", sans-serif;
           letter-spacing: -0.01em;
           text-transform: uppercase;
       }

       .search-btn:hover {
           background: #2c54e8;
       }

       .search-btn:active {
           background: #1e3a8a;
           transform: translateY(1px);
       }

       .header-right-nav {
           width: 100px;
           display: flex;
           align-items: center;
           justify-content: flex-end;
           flex-shrink: 0;
       }

       .header-right-nav a {
           color: #333;
           text-decoration: none;
           font-size: 13px;
           font-weight: 600;
           letter-spacing: -0.01em;
       }

       .breadcrumb {
           background: white;
           padding: 15px 0;
           border-bottom: 1px solid #e5e5e5;
       }

       .breadcrumb-content {
           max-width: 1400px;
           margin: 0 auto;
           padding: 0 20px;
           display: flex;
           align-items: center;
           gap: 8px;
           font-size: 14px;
       }

       .breadcrumb a {
           color: #666;
           text-decoration: none;
           font-weight: 500;
       }

       .breadcrumb a:hover {
           color: #0654ba;
       }

       .breadcrumb-separator {
           color: #999;
       }

       .breadcrumb-current {
           color: #333;
           font-weight: 600;
       }

       /* Sepet Ana Container */
       .basket-container {
           max-width: 1400px;
           margin: 0 auto;
           padding: 30px 20px;
           display: grid;
           grid-template-columns: 1fr 350px;
           gap: 30px;
           align-items: start;
       }

       .basket-header {
           grid-column: 1 / -1;
           margin-bottom: 20px;
       }

       .basket-title {
           font-size: 32px;
           font-weight: 700;
           color: #333;
           margin-bottom: 10px;
       }

       /* Sol Taraf - Ürünler */
       .basket-items {
           background: white;
           border-radius: 12px;
           overflow: hidden;
       }

       .basket-items-header {
           background: #f8f9fa;
           padding: 15px 20px;
           border-bottom: 1px solid #e5e5e5;
           font-size: 16px;
           font-weight: 700;
           color: #333;
       }

       .basket-item {
           display: grid;
           grid-template-columns: 80px 1fr auto auto auto;
           gap: 15px;
           padding: 20px;
           border-bottom: 1px solid #f0f0f0;
           align-items: center;
       }

       .basket-item:last-child {
           border-bottom: none;
       }

       .item-image {
           width: 80px;
           height: 80px;
           background: #f5f5f5;
           border-radius: 8px;
           display: flex;
           align-items: center;
           justify-content: center;
           overflow: hidden;
       }

       .item-image img {
           width: 100%;
           height: 100%;
           object-fit: cover;
       }

       .item-details {
           display: flex;
           flex-direction: column;
           gap: 5px;
       }

       .item-title {
           font-size: 16px;
           font-weight: 600;
           color: #333;
           text-decoration: underline;
           cursor: pointer;
       }

       .item-title:hover {
           color: #0654ba;
       }

       .item-specs {
           font-size: 14px;
           color: #666;
           font-weight: 500;
       }

       .item-status {
           font-size: 13px;
           color: #00a000;
           font-weight: 600;
       }

       .quantity-selector {
           display: flex;
           align-items: center;
           gap: 10px;
       }

       .quantity-label {
           font-size: 14px;
           color: #333;
           font-weight: 600;
       }

       .quantity-select {
           padding: 5px 10px;
           border: 1px solid #ccc;
           border-radius: 4px;
           font-size: 14px;
           font-weight: 600;
           background: white;
           cursor: pointer;
       }

       .item-price {
           font-size: 18px;
           font-weight: 700;
           color: #333;
           text-align: right;
       }

       .remove-item {
           background: none;
           border: none;
           color: #0654ba;
           font-size: 14px;
           font-weight: 600;
           cursor: pointer;
           text-decoration: underline;
           padding: 5px;
       }

       .remove-item:hover {
           color: #e74c3c;
       }

       /* Sağ Taraf - Özet */
       .basket-summary {
           background: white;
           border-radius: 12px;
           padding: 20px;
           height: fit-content;
           position: sticky;
           top: 20px;
       }

       .summary-row {
           display: flex;
           justify-content: space-between;
           align-items: center;
           padding: 10px 0;
           font-size: 16px;
       }

       .summary-row.items {
           border-bottom: 1px solid #f0f0f0;
           margin-bottom: 10px;
           font-weight: 600;
       }

       .summary-row.shipping {
           color: #666;
           font-size: 14px;
       }

       .summary-row.total {
           border-top: 1px solid #f0f0f0;
           margin-top: 15px;
           padding-top: 15px;
           font-size: 20px;
           font-weight: 700;
           color: #333;
       }

       .checkout-btn {
           width: 100%;
           background: #3665f3;
           color: white;
           border: none;
           padding: 15px;
           border-radius: 25px;
           font-size: 16px;
           font-weight: 700;
           cursor: pointer;
           margin-top: 20px;
           transition: all 0.2s ease;
           font-family: "Inter Tight", sans-serif;
           letter-spacing: -0.01em;
       }

       .checkout-btn:hover {
           background: #2c54e8;
           transform: translateY(-2px);
           box-shadow: 0 8px 25px rgba(54, 101, 243, 0.3);
       }

       /* Boş Sepet */
       .empty-basket {
           grid-column: 1 / -1;
           text-align: center;
           padding: 60px 20px;
           background: white;
           border-radius: 12px;
       }

       .empty-basket h3 {
           font-size: 24px;
           color: #333;
           margin-bottom: 10px;
           font-weight: 700;
       }

       .empty-basket p {
           font-size: 16px;
           color: #666;
           margin-bottom: 30px;
       }

       .empty-basket button {
           background: #3665f3;
           color: white;
           border: none;
           padding: 12px 24px;
           border-radius: 25px;
           font-size: 14px;
           font-weight: 600;
           cursor: pointer;
       }

       .empty-basket button:hover {
           background: #2c54e8;
       }

       /* Responsive Design */
       @media (max-width: 1200px) {
           .main-header-content {
               grid-template-columns: auto auto 1fr;
               gap: 15px;
           }
           
           .logo-container {
               width: 200px;
           }
           
           .logo img {
               max-width: 190px;
           }
           
           .category-container {
               width: 180px;
           }
           
           .header-right-nav {
               display: none;
           }
       }

       @media (max-width: 992px) {
           .basket-container {
               grid-template-columns: 1fr;
               gap: 20px;
           }
           
           .main-header-content {
               grid-template-columns: auto 1fr;
               gap: 15px;
           }
           
           .category-container {
               grid-column: 1 / -1;
               width: 100%;
               margin-top: 10px;
           }
           
           .logo-container {
               width: 180px;
               height: 60px;
           }
           
           .logo img {
               height: 540px;
               max-width: 170px;
           }
           
           .search-container {
               min-width: 250px;
           }
       }

       @media (max-width: 768px) {
           .basket-item {
               grid-template-columns: 60px 1fr;
               gap: 10px;
           }
           
           .quantity-selector, .item-price, .remove-item {
               grid-column: 1 / -1;
               justify-self: start;
               margin-top: 10px;
           }
           
           .main-header-content {
               grid-template-columns: 1fr;
               text-align: center;
               gap: 15px;
           }
           
           .logo-container {
               width: 100%;
               justify-content: center;
               height: 50px;
           }
           
           .logo img {
               height: 400px;
               max-width: 150px;
           }
           
           .search-section {
               width: 100%;
           }
           
           .search-container {
               min-width: auto;
               width: 100%;
           }
           
           .category-container {
               width: 100%;
               margin-top: 15px;
           }
       }

       @media (max-width: 480px) {
           .logo img {
               height: 300px;
               max-width: 120px;
           }
       }
   </style>
</head>
<body>
   <!-- Header Top -->
   <div class="header-top">
       <div class="header-top-content">
           <div class="header-left" id="headerLeft">
               <a href="login.html">Hi! Giriş Yap</a> veya 
               <a href="register.html">kayıt ol</a>
           </div>
           <div class="header-right">
               <a href="watchlist.html" class="watchlist-link">Watchlist</a>
               <a href="#" class="notification-icon"></a>
               <a href="basket.html" class="cart-icon"></a>
           </div>
       </div>
   </div>

   <!-- Main Header -->
   <div class="main-header">
       <div class="main-header-content">
           <div class="logo-container">
               <a href="index.html" class="logo">
                   <img src="images/logo.png" alt="Oyun Bahçesi Logo">
               </a>
           </div>
           
           <div class="category-container">
               <div class="category-dropdown">
                   <button class="category-btn" onclick="toggleDropdown()">
                       <span>Kategoriye</span>
                       <span>Göre</span>
                   </button>
                   <div class="dropdown-content" id="categoryDropdown">
                       <div class="dropdown-grid">
                           <div class="dropdown-column">
                               <h3>Kent Mobilyası</h3>
                               <ul>
                                   <li><a href="category.html?category=Kamelyalar">Kamelyalar</a></li>
                                   <li><a href="category.html?category=Pergole">Pergole</a></li>
                                   <li><a href="category.html?category=Köprüler">Köprüler</a></li>
                                   <li><a href="category.html?category=Bekçi%20Kulübesi">Bekçi Kulübesi</a></li>
                                   <li><a href="category.html?category=Çitler">Çitler</a></li>
                                   <li><a href="category.html?category=Banklar">Banklar</a></li>
                                   <li><a href="category.html?category=Saksılar">Saksılar</a></li>
                                   <li><a href="category.html?category=Kulübeler">Kulübeler</a></li>
                                   <li><a href="category.html?category=Yer%20ve%20Duvar%20Döşeme">Yer ve Duvar Döşeme</a></li>
                               </ul>
                           </div>
                           <div class="dropdown-column">
                               <h3>Oyun Grupları ve Parklar</h3>
                               <ul>
                                   <li><a href="category.html?category=Parklar">Parklar</a></li>
                                   <li><a href="category.html?category=Salıncaklar">Salıncaklar</a></li>
                                   <li><a href="category.html?category=Tırmanmalar">Tırmanmalar</a></li>
                                   <li><a href="category.html?category=Ahşap%20Oyun%20Evleri">Ahşap Oyun Evleri</a></li>
                                   <li><a href="category.html?category=Tahtarevalli%20ve%20Zıp%20Zıp">Tahtarevalli ve Zıp Zıp</a></li>
                                   <li><a href="category.html?category=Kauçuklar">Kauçuklar</a></li>
                                   <li><a href="category.html?category=Kum%20Havuzu">Kum Havuzu</a></li>
                               </ul>
                           </div>
                           <div class="dropdown-column">
    <h3>Ormanın Kalbi</h3>
    <ul>
        <li><a href="category.html?category=Orman%20Evleri">Orman Evleri</a></li>
    </ul>
</div>
                       </div>
                   </div>
               </div>
           </div>

           <div class="search-section">
               <div class="search-container">
                   <input type="text" class="search-input" placeholder="Sepetimde ara...">
               </div>
               <button class="search-btn">Ara</button>
           </div>
       </div>
   </div>

   <div class="breadcrumb">
       <div class="breadcrumb-content">
           <a href="index.html">Ana Sayfa</a>
           <span class="breadcrumb-separator">›</span>
           <span class="breadcrumb-current">Sepet</span>
       </div>
   </div>

   <div class="basket-container">
       <div class="basket-header">
           <h1 class="basket-title">Sepet</h1>
       </div>

       <!-- Sol Taraf - Ürünler -->
       <div class="basket-items" id="basketItems">
           <!-- Ürünler burada gösterilecek -->
       </div>

       <!-- Sağ Taraf - Özet -->
       <div class="basket-summary" id="basketSummary">
           <!-- Özet burada gösterilecek -->
       </div>
   </div>

   <script>
       // Kullanıcı durumunu kontrol et
       function checkUserStatus() {
           const currentUser = localStorage.getItem('currentUser');
           const headerLeft = document.getElementById('headerLeft');
           
           if (currentUser) {
               const user = JSON.parse(currentUser);
               if (user.loggedIn) {
                   headerLeft.innerHTML = `
                       <div style="display: flex; align-items: center; gap: 10px;">
                           <span style="color: #333; font-weight: 600;">Hi ${user.firstName}! ▼</span>
                           <a href="#" onclick="logout()" style="color: #0654ba; text-decoration: none; font-size: 12px; opacity: 0.8;">Çıkış</a>
                       </div>
                   `;
               }
           }
       }

       // Çıkış fonksiyonu
       function logout() {
           localStorage.removeItem('currentUser');
           location.reload();
       }

       // Ürünleri JSON'dan yükle
async function loadAllProductsFromJson() {
    try {
        const response = await fetch('https://raw.githubusercontent.com/KULLANICI_ADI/REPO_ADI/main/build/products.json');
        const data = await response.json();
        
        const allProducts = [];
        Object.values(data).forEach(categoryProducts => {
            allProducts.push(...categoryProducts);
        });
        
        return allProducts;
    } catch (error) {
        console.error('Ürünler yüklenirken hata:', error);
        return [];
    }
}

       // Sepeti yükle
       async function loadBasket() {
           const currentUser = localStorage.getItem('currentUser');
           
           if (!currentUser) {
               showLoginRequired();
               return;
           }

           const user = JSON.parse(currentUser);
           const basketKey = `basket_${user.email}`;
           const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
           
           // JSON'dan tüm mevcut ürünleri yükle
           const allProducts = await loadAllProductsFromJson();
           
           // Sepetteki ürünlerin hala JSON'da olup olmadığını kontrol et
           const validBasket = basket.filter(basketItem => {
               return allProducts.some(product => product.id == basketItem.id);
           });
           
           // Eğer silinen ürünler varsa sepeti güncelle
           if (validBasket.length !== basket.length) {
               localStorage.setItem(basketKey, JSON.stringify(validBasket));
               console.log(`${basket.length - validBasket.length} silinen ürün sepetten temizlendi`);
           }
           
           if (validBasket.length === 0) {
               showEmptyBasket();
               return;
           }

           // Ürünleri göster
           displayBasketItems(validBasket);
           displayBasketSummary(validBasket);
       }

       function showLoginRequired() {
           const basketItems = document.getElementById('basketItems');
           const basketSummary = document.getElementById('basketSummary');
           
           basketItems.innerHTML = `
               <div style="text-align: center; padding: 60px 20px;">
                   <div style="font-size: 48px; margin-bottom: 20px;">🔒</div>
                   <h3 style="font-size: 24px; color: #333; margin-bottom: 10px;">Giriş Yapmanız Gerekiyor</h3>
                   <p style="color: #666; font-size: 16px; margin-bottom: 30px;">Sepetinizi görmek için lütfen giriş yapın.</p>
                   <button onclick="window.location.href='login.html'" style="background: #3665f3; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 14px; font-weight: 600; cursor: pointer;">
                       Giriş Yap
                   </button>
               </div>
           `;
           basketSummary.innerHTML = '';
       }

       function showEmptyBasket() {
           const basketItems = document.getElementById('basketItems');
           const basketSummary = document.getElementById('basketSummary');
           
           basketItems.innerHTML = `
               <div style="text-align: center; padding: 60px 20px;">
                   <div style="font-size: 48px; margin-bottom: 20px;">🛒</div>
                   <h3 style="font-size: 24px; color: #333; margin-bottom: 10px;">Sepetiniz boş</h3>
                   <p style="color: #666; font-size: 16px; margin-bottom: 30px;">Henüz sepetinize ürün eklemediniz. Alışverişe başlayın!</p>
                   <button onclick="window.location.href='index.html'" style="background: #3665f3; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 14px; font-weight: 600; cursor: pointer;">
                       Alışverişe Başla
                   </button>
               </div>
           `;
           basketSummary.innerHTML = '';
       }

       function displayBasketItems(basket) {
           const basketItems = document.getElementById('basketItems');
           
           let html = `
               <div class="basket-items-header">
                   Sepetinizde ${basket.reduce((sum, item) => sum + item.quantity, 0)} ürün var
               </div>
           `;
           
           basket.forEach(item => {
               const imageHtml = item.image ? 
                   `<img src="${item.image}" alt="${item.title}">` : 
                   '<div style="color: #ccc; font-size: 12px;">Resim yok</div>';
               
               html += `
                   <div class="basket-item">
                       <div class="item-image">${imageHtml}</div>
                       <div class="item-details">
                           <div class="item-title" onclick="window.location.href='details.html?id=${item.id}'">${item.title}</div>
                           <div class="item-specs">${item.specs || ''}</div>
                           <div class="item-status">Stokta var</div>
                       </div>
                       <div class="quantity-selector">
                           <label class="quantity-label">Adet:</label>
                           <select class="quantity-select" onchange="updateQuantity('${item.id}', this.value)">
                               ${Array.from({length: 10}, (_, i) => i + 1).map(num => 
                                   `<option value="${num}" ${num == item.quantity ? 'selected' : ''}>${num}</option>`
                               ).join('')}
                           </select>
                       </div>
                       <div class="item-price">${formatPrice(item.price, item.quantity)}</div>
                       <button class="remove-item" onclick="removeFromBasket('${item.id}')">Kaldır</button>
                   </div>
               `;
           });
           
           basketItems.innerHTML = html;
       }

       function displayBasketSummary(basket) {
           const basketSummary = document.getElementById('basketSummary');
           
           const itemCount = basket.reduce((sum, item) => sum + item.quantity, 0);
           const subtotal = calculateSubtotal(basket);
           const shipping = 0; // Ücretsiz kargo
           const total = subtotal + shipping;
           
           basketSummary.innerHTML = `
               <div class="summary-row items">
                   <span>Ürünler (${itemCount})</span>
                   <span>${formatCurrency(subtotal)}</span>
               </div>
               <div class="summary-row shipping">
                   <span>Kargo</span>
                   <span>Ücretsiz</span>
               </div>
               <div class="summary-row total">
                   <span>Toplam</span>
                   <span>${formatCurrency(total)}</span>
               </div>
               <button class="checkout-btn" onclick="goToCheckout()">Satın Al</button>
           `;
       }

       function formatPrice(priceStr, quantity) {
           const cleanPrice = priceStr.replace('₺', '').replace(/\./g, '').replace(',', '.');
           const price = parseFloat(cleanPrice);
           const total = price * quantity;
           return `₺${total.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
       }

       function calculateSubtotal(basket) {
           return basket.reduce((sum, item) => {
               const cleanPrice = item.price.replace('₺', '').replace(/\./g, '').replace(',', '.');
               const price = parseFloat(cleanPrice);
               return sum + (price * item.quantity);
           }, 0);
       }

       function formatCurrency(amount) {
           return `₺${amount.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
       }

       // Sepete ürün ekleme
       function addToBasket(productId, title, price, image, specs) {
           const currentUser = localStorage.getItem('currentUser');
           if (!currentUser) return false;
           
           const user = JSON.parse(currentUser);
           const basketKey = `basket_${user.email}`;
           const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
           
           // Zaten var mı kontrol et
           const existingItem = basket.find(item => item.id === productId);
           if (existingItem) {
               // Miktarı artır
               existingItem.quantity += 1;
           } else {
               // Yeni ürün ekle
               basket.push({
                   id: productId,
                   title: title,
                   price: price,
                   image: image,
                   specs: specs,
                   quantity: 1,
                   addedAt: new Date().toISOString()
               });
           }
           
           localStorage.setItem(basketKey, JSON.stringify(basket));
           return true;
       }

       // Sepetten ürün çıkarma
// Sepetten ürün çıkarma
// Sepetten ürün çıkarma
function removeFromBasket(productId) {
    const currentUser = localStorage.getItem('currentUser');
    if (!currentUser) return;
    
    const user = JSON.parse(currentUser);
    const basketKey = `basket_${user.email}`;
    const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
    const filtered = basket.filter(item => item.id != productId);
    localStorage.setItem(basketKey, JSON.stringify(filtered));
    
    // Sayfayı yenile
    loadBasket();
}
       // Miktar güncelleme
       function updateQuantity(productId, newQuantity) {
           const currentUser = localStorage.getItem('currentUser');
           if (!currentUser) return;
           
           const user = JSON.parse(currentUser);
           const basketKey = `basket_${user.email}`;
           const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
           
           const item = basket.find(item => item.id == productId);
           if (item) {
              item.quantity = parseInt(newQuantity);
localStorage.setItem(basketKey, JSON.stringify(basket));

// Sadece özeti güncelle
// Tüm sepeti yeniden yükle
displayBasketItems(basket);
displayBasketSummary(basket);
               
               // Fiyatı güncelle
               const basketItems = document.getElementById('basketItems');
               const priceElements = basketItems.querySelectorAll('.item-price');
const removeButtons = basketItems.querySelectorAll(`[onclick*="removeFromBasket('${productId}')"]`);
if (removeButtons.length > 0) {
    const itemRow = removeButtons[0].closest('.basket-item');
    const priceElement = itemRow.querySelector('.item-price');
    if (priceElement) {
        priceElement.textContent = formatPrice(item.price, item.quantity);
    }
}
}
}

       // Sepet sayısını kontrol et
       function isInBasket(productId) {
           const currentUser = localStorage.getItem('currentUser');
           if (!currentUser) return false;
           
           const user = JSON.parse(currentUser);
           const basketKey = `basket_${user.email}`;
           const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
           return basket.some(item => item.id === productId);
       }

       // Checkout'a git
       function goToCheckout() {
           alert('Satın alma işlemi başlatılacak!\n\nBu demo sürümünde ödeme işlemi gerçekleştirilmez.');
       }

       // Sepette arama
       function searchBasket() {
           const searchTerm = document.querySelector('.search-input').value.toLowerCase().trim();
           const currentUser = localStorage.getItem('currentUser');
           if (!currentUser) return;
           
           const user = JSON.parse(currentUser);
           const basketKey = `basket_${user.email}`;
           const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
           
           if (!searchTerm) {
               displayBasketItems(basket);
               displayBasketSummary(basket);
               return;
           }
           
           const filtered = basket.filter(item => 
               item.title.toLowerCase().includes(searchTerm) ||
               (item.specs && item.specs.toLowerCase().includes(searchTerm))
           );
           
           displayBasketItems(filtered);
           displayBasketSummary(filtered);
       }

       // Dropdown toggle
       function toggleDropdown() {
           const dropdown = document.getElementById('categoryDropdown');
           dropdown.classList.toggle('show');
       }

       // Close dropdown when clicking outside
       window.onclick = function(event) {
           if (!event.target.matches('.category-btn') && !event.target.matches('.category-btn span')) {
               const dropdown = document.getElementById('categoryDropdown');
               if (dropdown.classList.contains('show')) {
                   dropdown.classList.remove('show');
               }
           }
       }

       // Event listeners
document.addEventListener('DOMContentLoaded', function() {
    checkUserStatus();
    updateCartBadge(); // BUNU EKLE
    listenForCartChanges(); // BUNU EKLE
    loadBasket();
    
    // Arama event listeners
    document.querySelector('.search-btn').addEventListener('click', searchBasket);
    document.querySelector('.search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchBasket();
        }
    });
    
    // Gerçek zamanlı arama
    document.querySelector('.search-input').addEventListener('input', function() {
        setTimeout(searchBasket, 300);
    });
});

       // Global fonksiyon - diğer sayfalardan erişim için
       window.addToBasket = addToBasket;
       window.isInBasket = isInBasket;

       // Sepet sayısını güncelle
function updateCartBadge() {
    const currentUser = localStorage.getItem('currentUser');
    const cartBadge = document.getElementById('cartBadge');
    
    if (!currentUser || !cartBadge) {
        if (cartBadge) cartBadge.classList.add('hidden');
        return;
    }
    
    const user = JSON.parse(currentUser);
    const basketKey = `basket_${user.email}`;
    const basket = JSON.parse(localStorage.getItem(basketKey) || '[]');
    
    const totalItems = basket.reduce((sum, item) => sum + item.quantity, 0);
    
    if (totalItems > 0) {
        cartBadge.textContent = totalItems > 99 ? '99+' : totalItems.toString();
        cartBadge.classList.remove('hidden');
    } else {
        cartBadge.classList.add('hidden');
    }
}

// LocalStorage değişikliklerini dinle
function listenForCartChanges() {
    window.addEventListener('storage', function(e) {
        if (e.key && e.key.includes('basket_')) {
            updateCartBadge();
        }
    });
    
    // Aynı sekme içindeki değişiklikleri takip et
    const originalSetItem = localStorage.setItem;
    localStorage.setItem = function(key, value) {
        originalSetItem.apply(this, arguments);
        if (key.includes('basket_')) {
            updateCartBadge();
        }
    };
}
   </script>
</body>
</html>